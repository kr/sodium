
def pair ():
  inline C set-cdr! <<end
    chunk p = rcv;

    if (args == nil) die("pair.set-cdr! -- not enough args");
    cdr(p) = car(args);
    return ok_sym;
  end

  inline C car <<end
    if (args != nil) die("pair.car -- too many args");
    return car(rcv);
  end

  inline C cdr <<end
    if (args != nil) die("pair.cdr -- too many args");
    return cdr(rcv);
  end

  (map f):
    cons (f (pair.car)) ((pair.cdr).map f)

  (filter f):
    def rest ((pair.cdr).filter f)
    if (f (pair.car)):
      cons (pair.car) rest
      . rest

  (run f):
    f (pair.car)
    (pair.cdr) f
    . 'ok

  (= p):
    if ((pair.car) = (p.car)):
      if ((pair.cdr) = (p.cdr)) true false
      . false

  (assq name):
    if (is? (pair.car.car) name) (pair.car) (pair.cdr.assq name)

def init ():
  inline C run <<end
    if (args == nil) die("install-pair -- not enough args");
    pair_surrogate = car(args);
    return ok_sym;
  end

init pair

. '()
