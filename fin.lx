inline C <<end
#include <stdio.h>

static void
fin_test_fn(void *i)
{
    if (i == (void *) 3) {
        printf("success\n");
    } else {
        printf("FAIL %p\n", i);
    }
}

end

def (f):
  def x ():
    inline C prepare <<end
      return grow_closure(&rcv, 1, (na_fn_free) fin_test_fn, (void *) 3);
    end

  x.prepare

export f
